<%- include('../userlayout/header.ejs')%>

    <body class="animsition" style="background-color: rgb(236, 236, 236)">


        <link rel="stylesheet" type="text/css" href="/usercss/logincss/css/orderlist.css">
        
        <body class="animsition">
		
		<div class="wrap-menu-desktop">
			<nav class="limiter-menu-desktop container">

				<!-- Logo desktop -->
                <h3 style="margin-right: 50px">Book Of Books</h3>

				<!-- Menu desktop -->
				<div class="menu-desktop">
					<ul class="main-menu">
						<li class="active-menu">
							<a href="/">Home</a>
						</li>

						<li>
							<a href="/shop">Shop</a>
						</li>

						<li class="label1" data-label1="hot">
							<a href="/Cart">Features</a>
						</li>

						<li>
							<a href="/blog">Blog</a>
						</li>

						<li>
							<a href="/About">About</a>
						</li>
					</ul>
				</div>
                        </nav>
                    </div>
               
        
                <!-- Header Mobile -->
                <div class="wrap-header-mobile">
                    <!-- Logo moblie -->
                    <div class="logo-mobile">
                        <a href="index.html"><img src="images/icons/logo-01.png" alt="IMG-LOGO"></a>
                    </div>
        
                    <!-- Icon header
                    <div class="wrap-icon-header flex-w flex-r-m m-r-15">
                        <div class="icon-header-item cl2 hov-cl1 trans-04 p-r-11 js-show-modal-search">
                            <i class="zmdi zmdi-search"></i>
                        </div>
        
                        <div class="icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti js-show-cart"
                            data-notify="2">
                            <i class="zmdi zmdi-shopping-cart"></i>
                        </div>
        
                        <a href="#" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti"
                            data-notify="0">
                            <i class="zmdi zmdi-favorite-outline"></i>
                        </a>
                    </div> -->
        
                    <!-- Button show menu -->
                    <div class="btn-show-menu-mobile hamburger hamburger--squeeze">
                        <span class="hamburger-box">
                            <span class="hamburger-inner"></span>
                        </span>
                    </div>
                </div>
        
        
        
        
                <!-- Modal Search -->
                <div class="modal-search-header flex-c-m trans-04 js-hide-modal-search">
                    <div class="container-search-header">
                        <button class="flex-c-m btn-hide-modal-search trans-04 js-hide-modal-search">
                            <img src="images/icons/icon-close2.png" alt="CLOSE">
                        </button>
        
                        <form class="wrap-search-header flex-w p-l-15">
                            <button class="flex-c-m trans-04">
                                <i class="zmdi zmdi-search"></i>
                            </button>
                            <input class="plh3" type="text" name="search" placeholder="Search...">
                        </form>
                    </div>
                </div>
            </header>
        
        
        
            <!-- breadcrumb -->
            <div class="container" style="padding: 50px;">
                <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
                    <a href="/" class="stext-109 cl8 hov-cl1 trans-04">
                        Home
                        <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
                    </a>
        
                    <span class="stext-109 cl4">
                        Shoping Cart
                    </span>
                </div>
            </div>
        
            <link rel="stylesheet" href="https://allyoucan.cloud/cdn/icofont/1.0.1/icofont.css" integrity="sha384-jbCTJB16Q17718YM9U22iJkhuGbS0Gd2LjaWb4YJEZToOPmnKDjySVa323U+W7Fv" crossorigin="anonymous">
            <link href="/usercss/orderstyle.css" rel="stylesheet">
<div class="container" >
    <div class="row" style="background-color: white;">
        <div class="col-md-3" >
            <div class="osahan-account-page-left shadow-sm bg-white h-100">
                <div class="border-bottom p-4">
                    <div class="osahan-user text-center">
                        <div class="osahan-user-media">
                            <img class="mb-3 rounded-pill shadow-sm mt-1" src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="gurdeep singh osahan">
                            <div class="osahan-user-media-body">
                                <h6 class="mb-2"><%= userdetails.name%></h6>
                                <p class="mb-1"><%=userdetails.mobile %></p>
                                <p><%=userdetails.email %></p>
                                <p><%=userdetails.wallet %></p>
                                <p class="mb-0 text-black font-weight-bold"><a class="text-primary mr-3" href="/profile"><i class="icofont-ui-edit"></i> EDIT</a></p>
                            </div>
                        </div>
                    </div>
                </div>
                <ul class="nav nav-tabs flex-column border-0 pt-4 pl-4 pb-4" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link" id="orders-tab" data-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="false"><i class="icofont-food-cart"></i> Orders</a>
                    </li>
                </ul>
            </div>
        </div>
        <div  class="col-md-9"  style="background-color: cyan;">
            <div class="osahan-account-page-right shadow-sm bg-white p-4 h-100">
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane  fade  active show" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                        <h4 class="font-weight-bold mt-0 mb-4"> Orders</h4>
                        <div class="bg-white card mb-4 order-list shadow-sm" id="reload">
                            <%order.forEach(( element,index)=> {%>
                            <div class="gold-members p-4">
                                <a href="#">
                                </a>
                                <div class="media">
                                    <div class="media-body" >
                                        <a href="#">
                                            <span class="float-right text-info">Ordered on <%= element.date.toISOString().slice(0,10)%><i class="icofont-check-circled text-success"></i></span>
                                        </a>
                                        <h6 class="mb-2">
                                            <a href="#"></a>
                                            <a href="#" class="text-black">  </a>
                                                
                                        </h6>
                                        <p class="text-gray mb-1"><i class="icofont-location-arrow"></i>PaymentType :<%=element.paymentType%>
                                        </p>
                                        <p class="text-gray mb-3"><i class="icofont-list"></i> ORDER ID <%= element._id %> 
                                        <% element.product.forEach((x,index)=>{ %>
                                        <p class="text-dark">
                                            <%=x.productid.name%>
                                        </p>
                                        <% }) %>
                                        <p class="text-gray mb-1"><i class="icofont-location-arrow"></i>Address :<%=element.delveryAddress%>
                                        </p>
                                        <hr>
                                        <% if(element.status=="Return requested"||element.status=="Returned"){ %>
                                        <div class="float-right">
                                           </i> Order Returned
                                        </div>
                                        <% }else if (element.status=="Delivered") { %>
                                            <div class="float-right">
                                                <button id="return_button" onclick=" returnorder('<%= element._id %>')"   type="button" class="btn btn-outline-danger">Return</button>
                                            </div>
                                            <% }else{ %>
                                               <% if(element.status != "cancelled"){ %>
                                                <div class="float-right">
                                                    <button onclick=" cancelorder('<%= element._id %>')"type="button" class="btn btn-outline-danger">Cancel</button>
                                                </div>
                                               <% }else{%>
                                                <div class="float-right">
                                                  <i class="icofont-headphone-alt"></i>Order Cancelled
                                                </div>
                                              <% } %>
                                                <% } %>
                                        <p class="mb-0 text-black text-primary pt-2"><span class="text-black font-weight-bold"> Total Paid:</span>
                                            <%=element.total %>
                                        </p>
                                    </div>
                                </div>

                            </div>
                            <% }) %>
                        </div>
                      
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


    
       
        
        <script>
function cancelorder(orderId){
    Swal.fire({
          title: 'Are you sure?',
          text: "You wan't to cancel!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'yes, cancel!'
        }).then((result) => {
     if (result.isConfirmed){
       $.ajax({
    url:'/cancel_order',
    data:{
    id:orderId
    },
    method:'POST',
    success:(response)=>{
if(response){
    if(response.cancelled){
            Swal.fire({
        icon: 'success',
        title: 'Cancelled',
        text: 'your order have been cancelled',
            })
              $('#reload').load('/orderview #reload')
        }

    }
  
    }
   })
   }
 })
 }

function returnorder(orderid){
     
    Swal.fire({
          title: 'Are you sure?',
          text: "You wan't to return!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'yes, return!'
        }).then((result) => {
     if (result.isConfirmed){
       $.ajax({
    url:'/return_order',
    data:{
    id:orderid
    },
    method:'POST',
    success:(response)=>{
        Swal.fire({
        icon: 'success',
        title: 'Return',
        text: 'your order will be Collected',
            })
            document.getElementById('return_button').innerHTML =response.status
            $('#reload').load('/orderview #reload')
}
       })
     
    }
        })
    }
        </script>
    
        <%- include('../userlayout/footer.ejs')%>